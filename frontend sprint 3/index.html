<!DOCTYPE html>
<html lang="es">
    <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EcoMarket — Frutas y Verduras</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Estilos adicionales para productos destacados -->
    <style>
        .featured-product-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .featured-product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }
        .offer-badge {
            background: linear-gradient(135deg, #28a745, #20c997);
            font-weight: bold;
            font-size: 0.8rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .price-original {
            font-size: 0.9rem;
            color: #6c757d !important;
        }
        .price-offer {
            color: #dc3545 !important;
            font-weight: bold;
        }
    </style>
    </head>
    <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top" style="background-color: #008c5a;">
    <div class="container-fluid">
        <!-- Logo -->
        <a class="navbar-brand fw-bold" href="index.html">EcoMarket</a>

        <!-- Iconos fijos a la derecha (siempre visibles) -->
        <div class="d-flex align-items-center gap-2 order-lg-3">
            <!-- Dropdown Usuario -->
            <div class="dropdown">
                <a href="#" class="text-white" role="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-person fs-5"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown" id="userDropdownMenu">
                    <!-- El contenido se genera dinámicamente con JavaScript -->
                </ul>
            </div>

            <!-- Carrito -->
            <a href="carrito.html" class="text-white position-relative">
                <i class="bi bi-cart fs-5"></i>
                <!-- Contador dinámico -->
                <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                0
                </span>  
            </a>
        </div>

        <!-- Botón Hamburguesa (corregido) -->
        <button class="navbar-toggler custom-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="custom-toggler-icon">
                <span></span>
                <span></span>
                <span></span>
            </span>
        </button>

        <!-- Links del menú -->
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link active" href="index.html">Inicio</a></li>
                <li class="nav-item"><a class="nav-link" href="catalogo.html">Catálogo</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Nosotros</a></li>
                <li class="nav-item"><a class="nav-link" href="#">Contacto</a></li>
            </ul>
        </div>
    </div>
    </nav>

    <!-- Carrusel -->
    <section id="hero" class="mb-5">
    <div id="carouselEcoMarket" class="carousel slide" data-bs-ride="carousel">
        <!-- Indicadores -->
        <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselEcoMarket" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselEcoMarket" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselEcoMarket" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>

        <!-- Slides -->
        <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="assets/img/banner1.jpg" class="d-block w-100" alt="Frutas frescas">
            <div class="carousel-caption d-none d-md-block">
            <h2>Frutas frescas directo del campo</h2>
            <p>Compra online y recibe en tu casa el mismo día</p>
            </div>
        </div>
        <div class="carousel-item">
            <img src="assets/img/banner2.jpg" class="d-block w-100" alt="Verduras orgánicas">
            <div class="carousel-caption d-none d-md-block">
            <h2>Verduras 100% orgánicas</h2>
            <p>Sin químicos, frescas y saludables</p>
            </div>
        </div>
        <div class="carousel-item">
            <img src="assets/img/banner3.jpg" class="d-block w-100" alt="Apoyo local">
            <div class="carousel-caption d-none d-md-block">
            <h2>Apoya a los agricultores locales</h2>
            <p>EcoMarket conecta productores con tu mesa</p>
            </div>
        </div>
        </div>

        <!-- Controles -->
        <button class="carousel-control-prev" type="button" data-bs-target="#carouselEcoMarket" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carouselEcoMarket" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Siguiente</span>
        </button>
    </div>
    </section>

        <!-- CATEGORÍAS RECOMENDADAS -->
    <section class="container my-5">
    <h2 class="text-center mb-4">Explora por categorías</h2>
    <div class="row g-4">
        <!-- Frutas -->
        <div class="col-lg-3 col-md-6 col-12">
        <a href="catalogo.html?categoria=frutas" class="category-card">
            <img src="assets/img/frutas.png" alt="Frutas" class="img-fluid rounded shadow">
            <div class="category-overlay">Frutas</div>
        </a>
        </div>
        <!-- Verduras -->
        <div class="col-lg-3 col-md-6 col-12">
        <a href="catalogo.html?categoria=verduras" class="category-card">
            <img src="assets/img/verduras.png" alt="Verduras" class="img-fluid rounded shadow">
            <div class="category-overlay">Verduras</div>
        </a>
        </div>
        <!-- Despensa -->
        <div class="col-lg-3 col-md-6 col-12">
        <a href="catalogo.html?categoria=despensa" class="category-card">
            <img src="assets/img/despensa.png" alt="Despensa" class="img-fluid rounded shadow">
            <div class="category-overlay">Despensa</div>
        </a>
        </div>
        <!-- Ofertas -->
        <div class="col-lg-3 col-md-6 col-12">
        <a href="catalogo.html?categoria=ofertas" class="category-card">
            <img src="assets/img/ofertas.png" alt="Ofertas" class="img-fluid rounded shadow">
            <div class="category-overlay">Ofertas</div>
        </a>
        </div>
    </div>
    </section>




    <!-- HERO -->
    <section class="hero d-flex align-items-center text-center text-white">
        <div class="container">
        <h1 class="h2 fw-light">Frutas y verduras frescas directo a tu mesa</h1>
        <p class="lead">Compra online y recibe en tu casa el mismo día</p>
        <a href="catalogo.html" class="btn btn-success btn-lg mt-3">Explorar catálogo</a>
        </div>
    </section>

    <!-- BENEFICIOS -->
    <section class="py-5 bg-light text-center">
        <div class="container">
        <h2 class="mb-5">¿Por qué elegir EcoMarket?</h2>
        <div class="row g-4">
            <div class="col-md-4">
            <i class="bi bi-leaf fs-1 text-success"></i>
            <h5 class="mt-3">Orgánico</h5>
            <p>Frutas y verduras libres de químicos, frescas y saludables.</p>
            </div>
            <div class="col-md-4">
            <i class="bi bi-truck fs-1 text-success"></i>
            <h5 class="mt-3">Entrega rápida</h5>
            <p>Recibe tus compras el mismo día en la puerta de tu casa.</p>
            </div>
            <div class="col-md-4">
            <i class="bi bi-people fs-1 text-success"></i>
            <h5 class="mt-3">Apoyo local</h5>
            <p>Apoyas a agricultores de tu zona comprando en EcoMarket.</p>
            </div>
        </div>
        </div>
    </section>

    <!-- PRODUCTOS DESTACADOS -->
    <section class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">Productos destacados</h2>
            <div class="row g-4" id="featured-products">
                <!-- Los productos se cargarán dinámicamente -->
            </div>
            
            <!-- Enlace al catálogo completo -->
            <div class="text-center mt-5">
                <a href="catalogo.html" class="btn btn-outline-success btn-lg">
                    <i class="bi bi-grid-3x3-gap me-2"></i>Ver catálogo completo
                </a>
            </div>
        </div>
    </section>

    <!-- Incluir catalog.js para funciones de productos -->
    <script src="assets/js/catalog.js"></script>
    
    <script>
        // IDs de productos destacados (se tomarán del sistema real de productos)
        const featuredProductIds = ['lechuga', 'frutillas', 'tomates', 'zanahorias'];

        // Función para obtener productos del sistema real
        function getFeaturedProducts() {
            // Usar la función getProducts() del catálogo para obtener datos actualizados
            const allProducts = getProducts();
            return allProducts.filter(product => featuredProductIds.includes(product.id));
        }

        // Función para renderizar productos destacados
        function renderFeaturedProducts() {
            const container = document.getElementById('featured-products');
            const featuredProducts = getFeaturedProducts();
            
            if (featuredProducts.length === 0) {
                container.innerHTML = '<div class="col-12 text-center"><p class="text-muted">No hay productos destacados disponibles</p></div>';
                return;
            }
            
            const productsHTML = featuredProducts.map(product => {
                // Determinar estado del producto usando datos reales
                let statusBadges = [];
                let buttonContent = '';
                let buttonClass = 'btn btn-success btn-sm';
                let buttonAction = `addToCartFromFeatured('${product.id}')`;

                // Badge de oferta (prioridad máxima)
                if (product.isOffer && product.originalPrice) {
                    const discountPercent = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                    statusBadges.push(`<span class="badge offer-badge position-absolute top-0 start-0 m-2" style="z-index: 10;">-${discountPercent}% OFF</span>`);
                }

                // Badge de stock
                if (!product.available || product.stock === 0) {
                    statusBadges.push('<span class="badge bg-danger position-absolute top-0 end-0 m-2">Sin stock</span>');
                    buttonContent = '<i class="bi bi-x-circle me-1"></i>No disponible';
                    buttonClass = 'btn btn-secondary btn-sm';
                    buttonAction = `showNotAvailable('${product.name}')`;
                } else if (product.stock <= 5) {
                    statusBadges.push('<span class="badge bg-warning position-absolute top-0 end-0 m-2">¡Últimas unidades!</span>');
                    buttonContent = '<i class="bi bi-cart-plus me-1"></i>Agregar';
                } else {
                    buttonContent = '<i class="bi bi-cart-plus me-1"></i>Agregar';
                }

                const statusBadgesHTML = statusBadges.join('');

                return `
                    <div class="col-12 col-sm-6 col-lg-3">
                        <div class="card h-100 shadow-sm position-relative featured-product-card">
                            ${statusBadgesHTML}
                            <img src="${product.image}" class="card-img-top" alt="${product.name}" style="height: 200px; object-fit: cover;">
                            <div class="card-body d-flex flex-column">
                                <h5 class="card-title">${product.name}</h5>
                                <p class="card-text text-muted small flex-grow-1">${product.description}</p>
                                
                                <div class="mt-auto">
                                    <div class="mb-2">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                ${product.isOffer && product.originalPrice ? 
                                                    `<div><span class="price-original text-decoration-line-through">$${product.originalPrice.toLocaleString()}</span></div>
                                                     <div><span class="price-offer fs-5">$${product.price.toLocaleString()}</span></div>` 
                                                    : 
                                                    `<span class="fw-bold text-success fs-5">$${product.price.toLocaleString()}</span>`
                                                }
                                            </div>
                                            <small class="text-muted">por ${product.unit}</small>
                                        </div>
                                    </div>
                                    
                                    ${product.available && product.stock > 0 ? `
                                        <div class="text-center mb-2">
                                            <small class="text-success">
                                                <i class="bi bi-check-circle me-1"></i>
                                                ${product.stock} disponibles
                                            </small>
                                        </div>
                                    ` : ''}
                                    
                                    <div class="d-grid">
                                        <button class="${buttonClass}" onclick="${buttonAction}">
                                            ${buttonContent}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = productsHTML;
        }

        // Función para agregar al carrito desde productos destacados (usa la misma lógica que el catálogo)
        function addToCartFromFeatured(productId) {
            // Usar la función addToCart del catálogo que ya maneja todo correctamente
            addToCart(productId);
            
            // Actualizar la vista de productos destacados para reflejar cambios de stock
            setTimeout(() => {
                renderFeaturedProducts();
            }, 500);
        }

        // Función para mostrar mensaje de no disponible
        function showNotAvailable(productName) {
            if (typeof showToast === 'function') {
                showToast(`${productName} no está disponible en este momento`, 'info');
            } else {
                showNotification(`${productName} no está disponible en este momento`, 'info');
            }
        }

        // Función para mostrar notificaciones (usar la de app.js si existe)
        function showNotification(message, type = 'success', duration = 4000) {
            // Si existe la función global de app.js, usarla
            if (typeof window.showNotification === 'function') {
                window.showNotification(message, type, duration);
                return;
            }

            // Fallback: notificación simple
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : type === 'warning' ? 'warning' : 'info'} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="bi bi-${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }

        // Función para actualizar contador del carrito
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('ecomarket_cart')) || [];
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const cartCountElement = document.getElementById('cart-count');
            
            if (cartCountElement) {
                cartCountElement.textContent = totalItems;
                cartCountElement.style.display = totalItems > 0 ? 'block' : 'none';
            }
        }

        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar productos si no existen
            initializeProducts();
            
            // Renderizar productos destacados
            renderFeaturedProducts();
            
            // Actualizar contador del carrito
            updateCartCount();
        });

        // Escuchar cambios en los productos desde el admin
        window.addEventListener('productsUpdated', function(event) {
            console.log('Productos actualizados desde admin, recargando productos destacados');
            renderFeaturedProducts();
        });

        // Escuchar cambios en el localStorage de productos (si se actualiza desde otra pestaña)
        window.addEventListener('storage', function(event) {
            if (event.key === 'ecomarket_products') {
                console.log('Productos actualizados en localStorage, recargando productos destacados');
                renderFeaturedProducts();
            }
        });
    </script>    <!-- Footer Container -->
    <div id="footer-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/js/footer.js"></script>
    
    <script>
        // Footer inline como backup
        document.addEventListener('DOMContentLoaded', function() {
            const container = document.getElementById('footer-container');
            if (container && !container.innerHTML.trim()) {
                console.log('🔧 Cargando footer inline como backup...');
                container.innerHTML = `
                <footer class="footer">
                    <div class="footer-top">
                        <p>¿Te queda alguna duda? Capaz que esta información te sirva ;)</p>
                    </div>
                    <div class="footer-content">
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('pasillos')">
                                PASILLOS <i class="bi bi-chevron-down accordion-icon" id="pasillos-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="pasillos-content">
                                <li><a href="catalogo.html?categoria=frutas">Frutas</a></li>
                                <li><a href="catalogo.html?categoria=verduras">Verduras</a></li>
                                <li><a href="catalogo.html?categoria=despensa">Despensa</a></li>
                                <li><a href="catalogo.html?categoria=ofertas">Ofertas</a></li>
                            </ul>
                        </div>
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('paginas')">
                                PÁGINAS <i class="bi bi-chevron-down accordion-icon" id="paginas-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="paginas-content">
                                <li><a href="index.html">Inicio</a></li>
                                <li><a href="catalogo.html">Catálogo</a></li>
                                <li><a href="carrito.html">Carrito</a></li>
                                <li><a href="login.html">Mi cuenta</a></li>
                            </ul>
                        </div>
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('contacto')">
                                CONTACTO <i class="bi bi-chevron-down accordion-icon" id="contacto-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="contacto-content">
                                <li><a href="tel:+573001234567">📞 +57 300 123 4567</a></li>
                                <li><a href="mailto:info@ecomarket.com">✉️ info@ecomarket.com</a></li>
                                <li><a href="#">📍 Calle 123 #45-67, Ciudad</a></li>
                            </ul>
                        </div>
                        <div class="footer-section">
                            <h4 class="footer-accordion-header" onclick="toggleAccordion('politicas')">
                                POLÍTICAS <i class="bi bi-chevron-down accordion-icon" id="politicas-icon"></i>
                            </h4>
                            <ul class="footer-accordion-content" id="politicas-content">
                                <li><a href="#">Términos y condiciones</a></li>
                                <li><a href="#">Política de privacidad</a></li>
                                <li><a href="#">Política de devoluciones</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="footer-divider"></div>
                    <div class="footer-bottom">
                        <p>&copy; 2024 EcoMarket. Todos los derechos reservados. | Frutas y verduras frescas para tu mesa</p>
                    </div>
                </footer>
                `;
                console.log('✅ Footer inline cargado exitosamente');
            }
        });
    </script>
    </body>
</html>
